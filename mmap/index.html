<!DOCTYPE html>

<html>
<head>
<link rel="stylesheet" href="style.css" type="text/css">
<script type="text/javascript"
src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCBXytsTGPDgxCcgRFdOuLLj7yh2jInP40">
</script>
<script>
var map = null;
var names = {"nr":"Norman Ramsey", "snape":"Professor Severus Snape", 
    "carmen":"Carmen", "waldo":"Waldo", "hescott":"Professor Ben Hescott",
    "batman":"Batman"
};
function initialize() {
    var mapOptions = {
center: { lat: 42.2846847,lng:-71.064473621 },
        zoom: 16
    };
    map = new google.maps.Map(document.getElementById('map-canvas'),
            mapOptions);
    var geocoder = new google.maps.Geocoder();
    var pos = {lat:0, lng:0}
}
google.maps.event.addDomListener(window, 'load', initialize);
var xhr = new XMLHttpRequest();
xhr.open("POST", "http://chickenofthesea.herokuapp.com/sendLocation");
xhr.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
xhr.onreadystatechange = function () {
    if (xhr.readyState == 4 && xhr.status == 200) {
        //console.log(xhr.responseText);
        people = JSON.parse(xhr.responseText);
        people.characters.map(function(person) {
                var marker = new google.maps.Marker({map:map, position:{lat:person.loc.latitude, lng:person.loc.longitude}, icon:person.name+'.png'}) 
                var infoWindow = new google.maps.InfoWindow(
                    {content:"<h1>"+names[person.name]+"</h1>"}
                    );
                infoWindow.open(map, marker);
                });
        people.students.map(function(person) {
                var marker = new google.maps.Marker({map:map, position:{lat:person.lat, lng:person.lng}, icon:google.maps.CIRCLE});
                var infoWindow = new google.maps.InfoWindow(
                    {content:"<h1>"+person.login+"</h1>"});
                infoWindow.open(map, marker);
                });
    }
}
navigator.geolocation.getCurrentPosition(
        function(position) {
            xhr.send("login=PeterGriffin&lat="+position.coords.latitude+"&lng="+position.coords.longitude);
            map.center=position.coords;
            var marker = new google.maps.Marker({map:map, position:{lat:position.coords.latitude, lng:position.coords.longitude}, icon:google.maps.blu_circle});
            }
        );

</script>
</head>
<body>
<div id="map-canvas"></div>
</body>
</html>
